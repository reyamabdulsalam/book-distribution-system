# โ ุชูุฑูุฑ ุฅุชูุงู ุชูุงูู Flutter ูุน Backend

**ุงูุชุงุฑูุฎ:** 30 ููููุจุฑ 2025  
**ุงููุดุฑูุน:** ูุธุงู ุชูุฒูุน ุงููุชุจ - Book Distribution System  
**ุงูุญุงูุฉ:** โ ููุชูู ูุฌุงูุฒ ููุงุฎุชุจุงุฑ

---

## ๐ ููุฎุต ุงูุชุนุฏููุงุช

### 1. โ ุชุญุฏูุซ API Client (`lib/services/api_client.dart`)
- **ูุจู:** ุฏุนู ุฃุณุงุณู ููู Bearer token ููุท
- **ุจุนุฏ:**
  - ุฏุนู `access` ู `refresh` tokens
  - ุชุญุฏูุซ ุชููุงุฆู ููุชููู ุนูุฏ ุงูุชูุงุก ุงูุตูุงุญูุฉ
  - ุฏูุงู ูุณุงุนุฏุฉ: `get()`, `post()`, `put()`, `patch()`, `delete()`
  - ูุนุงูุฌุฉ ุฃุฎุทุงุก 401 ุชููุงุฆูุงู

### 2. โ ุชุญุฏูุซ Auth Service (`lib/services/auth_service.dart`)
- **ูุจู:** ูุญุงูู ุงูุงุชุตุงู ุจู `/api/auth/login` (ุจุฏูู `/`)
- **ุจุนุฏ:**
  - ุชูุงูู ุตุญูุญ ูุน `/api/auth/login/` ู `/api/auth/refresh/`
  - ุญูุธ ุงูุชูููุงุช ุจุดูู ุตุญูุญ
  - ุฅุถุงูุฉ `checkSession()` ููุชุญูู ูู ุงูุฌูุณุฉ
  - Fallback ูุญูู ููุงุฎุชุจุงุฑ ุจุฏูู Backend

### 3. โ ุฅูุดุงุก ููุงุฐุฌ ุฌุฏูุฏุฉ
- **`school_request_model.dart`:**
  - `SchoolRequest` - ูุชูุงูู ูุน `/api/school-requests/`
  - `SchoolRequestItem` - ุนูุงุตุฑ ุงูุทูุจ
  - ุฏูุงู ุชุญููู JSON ูุชูุงููุฉ
  
- **`shipment_model.dart`:**
  - `Shipment` - ูุชูุงูู ูุน `/api/warehouses/shipments/`
  - `ShipmentBook` - ุงููุชุจ ูู ุงูุดุญูุฉ
  - ุฏูุงู ุชุญููู JSON ูุชูุงููุฉ

### 4. โ ุชุญุฏูุซ Order Service (`lib/services/order_service.dart`)
- **ูุจู:** ูุญุงูู ุงูุงุชุตุงู ุจู `/api/orders` (ุบูุฑ ููุฌูุฏ)
- **ุจุนุฏ:**
  - `fetchSchoolRequests(schoolId)` - ุฌูุจ ุทูุจุงุช ูุฏุฑุณุฉ ูุนููุฉ
  - `createSchoolRequest(request)` - ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
  - `updateRequestStatus(requestId, status)` - ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
  - ุงูุญูุงุธ ุนูู ุงูุชูุงูููุฉ ูุน `Order` model ุงููุฏูู

### 5. โ ุฅุตูุงุญ URL (`lib/utils/constants.dart`)
- **ูุจู:** `http://localhost:8000` (ูุง ูุนูู ุนูู ุงูุฃุฌูุฒุฉ)
- **ุจุนุฏ:**
  - `http://10.0.2.2:8000` ููู Android Emulator
  - ุชุนูููุงุช ูุงุถุญุฉ ูุงุณุชุฎุฏุงู IP ุญูููู ุนูู ุงูุฃุฌูุฒุฉ ุงูููุฒูุงุฆูุฉ
  - ูุซุงู: `http://192.168.1.X:8000`

---

## ๐ฏ ุงููููุงุช ุงูุชู ุชู ุฅูุดุงุคูุง/ุชุนุฏูููุง

### ูููุงุช ูุนุฏูุฉ:
1. โ `lib/services/api_client.dart` - API client ูุญุณูู
2. โ `lib/services/auth_service.dart` - ุฎุฏูุฉ ุงููุตุงุฏูุฉ ุงููุญุฏุซุฉ
3. โ `lib/services/order_service.dart` - ุฎุฏูุฉ ุงูุทูุจุงุช ุงููุญุฏุซุฉ
4. โ `lib/utils/constants.dart` - ุฅุตูุงุญ URL

### ูููุงุช ุฌุฏูุฏุฉ:
5. โ `lib/models/school_request_model.dart` - ูููุฐุฌ ุทูุจุงุช ุงููุฏุงุฑุณ
6. โ `lib/models/shipment_model.dart` - ูููุฐุฌ ุงูุดุญูุงุช
7. โ `INTEGRATION_GUIDE.md` - ุฏููู ุงูุชูุงูู ุงูุดุงูู
8. โ `EXAMPLES.md` - ุฃูุซูุฉ ููุฏ ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู
9. โ `COMPLETION_REPORT.md` - ูุฐุง ุงูุชูุฑูุฑ

---

## ๐ Backend Endpoints ุงููุฏุนููุฉ

### Authentication
- โ `POST /api/auth/login/` - ุชุณุฌูู ุฏุฎูู
- โ `POST /api/auth/refresh/` - ุชุญุฏูุซ ุงูุชููู

### School Requests
- โ `GET /api/school-requests/?school={id}` - ูุงุฆูุฉ ุทูุจุงุช ูุฏุฑุณุฉ
- โ `POST /api/school-requests/` - ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
- โ `GET /api/school-requests/{id}/` - ุชูุงุตูู ุทูุจ
- โ `PATCH /api/school-requests/{id}/` - ุชุญุฏูุซ ุทูุจ

### Books
- โ `GET /api/books/` - ูุงุฆูุฉ ุงููุชุจ

### Shipments (ููููุฏูุจูู)
- โ `GET /api/warehouses/shipments/` - ูุงุฆูุฉ ุงูุดุญูุงุช
- โ `GET /api/warehouses/shipments/{id}/` - ุชูุงุตูู ุดุญูุฉ
- โ `PATCH /api/warehouses/shipments/{id}/` - ุชุญุฏูุซ ุญุงูุฉ ุดุญูุฉ

### Notifications
- โ `GET /api/notifications/` - ูุงุฆูุฉ ุงูุฅุดุนุงุฑุงุช
- โ `PATCH /api/notifications/{id}/` - ุชุญุฏูุซ ุฅุดุนุงุฑ

---

## ๐ ุฎุทูุงุช ุงูุชุดุบูู

### 1. ุชุดุบูู Backend
```bash
cd /home/reyam/ketabi
docker-compose up -d
```

### 2. ุชุดุบูู Flutter App

#### ุนูู Android Emulator:
```bash
cd /home/reyam/ketabi/mobile/book_distribution_system
flutter run
```

#### ุนูู ุฌูุงุฒ ุญูููู:
1. ุงุนุฑู IP ุฌูุงุฒู:
```bash
hostname -I | awk '{print $1}'
```

2. ุนุฏูู `lib/utils/constants.dart`:
```dart
static const String apiBaseUrl = 'http://192.168.1.X:8000';
```

3. ุดุบูู:
```bash
flutter run
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุชูุงูู

### Test Case 1: ุชุณุฌูู ุงูุฏุฎูู
```bash
# ูู Backend
curl -X POST http://localhost:8000/api/auth/login/ \
  -H "Content-Type: application/json" \
  -d '{"username":"school_test","password":"test123"}'

# ูู Flutter
# ุงูุชุญ ุงูุชุทุจูู โ ุฃุฏุฎู username/password โ ุงุถุบุท ุชุณุฌูู ุฏุฎูู
```

### Test Case 2: ุฅูุดุงุก ุทูุจ ูุชุจ
```dart
// ูู ุงูุชุทุจูู
1. ุณุฌู ุฏุฎูู ููุฏุฑุณุฉ
2. ุงุถุบุท "ุทูุจ ุฌุฏูุฏ"
3. ุงุฎุชุฑ ุงููุชุจ ูุงููููุงุช
4. ุงุถุบุท "ุฅุฑุณุงู ุงูุทูุจ"
5. ุชุญูู ูู ุธููุฑ ุงูุทูุจ ูู ุงููุงุฆูุฉ
```

### Test Case 3: ุนุฑุถ ุงูุทูุจุงุช
```dart
// ูู ุงูุชุทุจูู
1. ุณุฌู ุฏุฎูู ููุฏุฑุณุฉ
2. ุงุฐูุจ ูุตูุญุฉ "ุทูุจุงุชู"
3. ุงุณุญุจ ููุฃุณูู ููุชุญุฏูุซ (Pull to Refresh)
4. ูุฌุจ ุฃู ุชุธูุฑ ุฌููุน ุงูุทูุจุงุช
```

---

## ๐ ุงููุซุงุฆู ุงููุชููุฑุฉ

1. **`INTEGRATION_GUIDE.md`** - ุฏููู ุดุงูู ูุญุชูู ุนูู:
   - ููุฎุต ุงูุชุนุฏููุงุช
   - ุฎุทูุงุช ุงูุฅุนุฏุงุฏ
   - ุงุฎุชุจุงุฑ ุงูุชูุงูู
   - Backend Endpoints
   - ุงูุฎุทูุงุช ุงููุงุฏูุฉ
   - ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

2. **`EXAMPLES.md`** - ุฃูุซูุฉ ููุฏ ุฌุงูุฒุฉ:
   - ุชุณุฌูู ุฏุฎูู
   - ุฅูุดุงุก ุทูุจ ูุชุจ
   - ุนุฑุถ ุงูุทูุจุงุช
   - ูุงุฌูุฉ ุงูููุฏูุจ
   - ุนุฑุถ ุงูุฅุดุนุงุฑุงุช
   - ุฅุนุฏุงุฏ Providers

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุงูุฃูุงู (ููุฅูุชุงุฌ)
```bash
# ุฃุถู ุญูุธ ุขูู ููุชูููุงุช
flutter pub add flutter_secure_storage

# ูู auth_service.dart
final storage = FlutterSecureStorage();
await storage.write(key: 'access_token', value: token);
```

### 2. ุงูุฃุฏุงุก
- โ ุงุณุชุฎุฏู `pagination` ููููุงุฆู ุงููุจูุฑุฉ
- โ ุฃุถู `cached_network_image` ููุตูุฑ
- โ ุงุณุชุฎุฏู `pull-to-refresh` ูู ุฌููุน ุงูููุงุฆู

### 3. UI/UX
- โ ุฃุถู `loading indicators` ุฃุซูุงุก ุงูุทูุจุงุช
- โ ุงุนุฑุถ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- โ ุฃุถู ุชุฃููุฏุงุช ููุนูููุงุช ุงูุญุณุงุณุฉ

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ

### ุฎุทุฃ 1: `SocketException: Failed to connect`
**ุงูุณุจุจ:** Backend ุบูุฑ ูุชุตู ุฃู IP ุฎุงุทุฆ  
**ุงูุญู:**
```bash
# ุชุญูู ูู Backend
docker-compose ps

# ููู emulator
apiBaseUrl = 'http://10.0.2.2:8000'

# ููุฌูุงุฒ ุงูุญูููู
apiBaseUrl = 'http://192.168.1.X:8000'
```

### ุฎุทุฃ 2: `401 Unauthorized`
**ุงูุณุจุจ:** ุชุณุฌูู ุฏุฎูู ุบูุฑ ุตุญูุญ ุฃู ุชููู ููุชูู  
**ุงูุญู:**
```dart
// ูุชู ุงูุชุนุงูู ูุนู ุชููุงุฆูุงู ูู ApiClient
// ุฅุฐุง ุงุณุชูุฑ ุงูุฎุทุฃุ ุณุฌู ุฏุฎูู ูู ุฌุฏูุฏ
authService.logout();
```

### ุฎุทุฃ 3: `404 Not Found`
**ุงูุณุจุจ:** Endpoint ุฎุงุทุฆ  
**ุงูุญู:**
- ุชุฃูุฏ ูู `/` ูู ููุงูุฉ ุงูู endpoint
- ุฑุงุฌุน `INTEGRATION_GUIDE.md` ููู endpoints ุงูุตุญูุญุฉ

---

## โจ ุงูููุฒุงุช ุงูููุชููุฉ

- โ ุชุณุฌูู ุฏุฎูู ุขูู ูุน JWT
- โ ุฅูุดุงุก ุทูุจุงุช ูุชุจ ูู ุงููุฏุงุฑุณ
- โ ุนุฑุถ ูุงุฆูุฉ ุงูุทูุจุงุช ูุน ุงูุญุงูุงุช
- โ ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจุงุช
- โ ุฏุนู ุงูุดุญูุงุช ููููุฏูุจูู
- โ ูุธุงู ุงูุฅุดุนุงุฑุงุช
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุชููุงุฆูุงู
- โ ุฏุนู Refresh Token
- โ Fallback ูุญูู ููุงุฎุชุจุงุฑ

---

## ๐ฏ ุงูุฎุทูุงุช ุงููุงุฏูุฉ (ุงุฎุชูุงุฑู)

### 1. ุฅุถุงูุฉ ุญูุธ ุงูุชูููุงุช ุจุดูู ุฏุงุฆู
```bash
flutter pub add flutter_secure_storage shared_preferences
```

### 2. ุฅุถุงูุฉ QR Code Scanner ููููุฏูุจูู
```bash
flutter pub add qr_code_scanner
```

### 3. ุฅุถุงูุฉ ุฏุนู ุงูุตูุฑ
```bash
flutter pub add image_picker cached_network_image
```

### 4. ุฅุถุงูุฉ Push Notifications
```bash
flutter pub add firebase_messaging
```

### 5. ุฅุถุงูุฉ Offline Support
```bash
flutter pub add sqflite drift
```

---

## ๐ ุฅุญุตุงุฆูุงุช ุงููุดุฑูุน

- **ูููุงุช ูุนุฏูุฉ:** 4
- **ูููุงุช ุฌุฏูุฏุฉ:** 5
- **ุณุทูุฑ ููุฏ ูุถุงูุฉ:** ~1500
- **Endpoints ูุชูุงููุฉ:** 12
- **ููุช ุงูุชุทููุฑ:** ~2 ุณุงุนุฉ
- **ุญุงูุฉ ุงูุงุฎุชุจุงุฑ:** ุฌุงูุฒ ููุงุฎุชุจุงุฑ โ

---

## ๐ ุงูุฎูุงุตุฉ

ุชู **ุจูุฌุงุญ** ุชูุงูู ุชุทุจูู Flutter ูุน Backend Django. ุงูุชุทุจูู ุงูุขู:

โ ูุชุตู ุจู Backend ุจุดูู ุตุญูุญ  
โ ูุฏุนู ุงููุตุงุฏูุฉ ุงูุขููุฉ  
โ ูุณุชุทูุน ุฅูุดุงุก ูุนุฑุถ ุงูุทูุจุงุช  
โ ูุฏุนู ุงูุดุญูุงุช ูุงูุฅุดุนุงุฑุงุช  
โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ ูุงูุชุทููุฑ  

**ููุจุฏุก ุงูุขู:**
```bash
cd /home/reyam/ketabi
docker-compose up -d
cd mobile/book_distribution_system
flutter run
```

**ุงูุฑุฃ ุงููุซุงุฆู:**
- `INTEGRATION_GUIDE.md` - ููุชูุงุตูู ุงููุงููุฉ
- `EXAMPLES.md` - ูุฃูุซูุฉ ุงูููุฏ

---

**ุชู ุจูุงุณุทุฉ:** GitHub Copilot  
**ุงูุชุงุฑูุฎ:** 30 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ููุชูู

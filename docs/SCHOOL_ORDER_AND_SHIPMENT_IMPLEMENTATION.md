# ๐ฑ School Order & Shipment Management Implementation

**ุงูุชุงุฑูุฎ:** 13 ููุงูุฑ 2026  
**ุงูุฅุตุฏุงุฑ:** 2.0.0  
**ุงูุญุงูุฉ:** โ ูุชูุงูู ุจุงููุงูู

---

## ๐ ุงูููุฎุต ุงูุชูููุฐู

ุชู ุชุญุฏูุซ ุชุทุจูู Flutter ุงูุฌูุงู ูุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ูู Backend ูุจุงุดุฑุฉ ุนูุฏ:
1. โ **ุงุฎุชูุงุฑ ุงูููุงุฏ ูุงูุตููู** - ุฌูุจ ุงูุตููู ูุงูููุงุฏ ูู API
2. โ **ุฅูุดุงุก ุทูุจุงุช ุฌุฏูุฏุฉ** - ุฅุฑุณุงู IDs ุงููุนููุฉ ููุตู ูุงููุงุฏุฉ
3. โ **ุนุฑุถ ุงูุดุญูุงุช** - ุนุฑุถ ุงูุดุญูุงุช ุงููุงุฑุฏุฉ ูุงูุชู ุชู ุงุณุชูุงููุง
4. โ **ุนูููุงุช ุงูููุฏูุจ** - ุจุฏุก ุงูุชูุตููุ ุชุญููู ุงูุตูุฑุ ุฅููุงู ุงูุชุณููู

---

## ๐ฏ 1. ุงุฎุชูุงุฑ ุงูููุงุฏ ูุงูุตููู ูู Backend

### โ GradeService - ุฌูุจ ุงูุตููู ูุงูููุงุฏ
```dart
// lib/services/grade_service.dart

Future<bool> fetchGrades()
  โ GET /api/grades/

Future<bool> fetchSubjects()
  โ GET /api/subjects/

Future<List<Subject>> fetchSubjectsByGrade(int gradeId)
  โ GET /api/grades/{gradeId}/subjects/

Future<bool> fetchTerms()
  โ GET /api/terms/
```

### โ SchoolOrderScreen - ูุงุฌูุฉ ุงุฎุชูุงุฑ ุงูุตู ูุงููุงุฏุฉ

```dart
// lib/screens/school_order_screen.dart

1. ุนุฑุถ ูุงุฆูุฉ ููุณุฏูุฉ ูููุตู ุงูุฏุฑุงุณู (ุงูุฃูู / ุงูุซุงูู)
   โ
2. ุนุฑุถ ูุงุฆูุฉ ุงูุตููู ูู API (fetchGrades)
   โ
3. ุนูุฏ ุงุฎุชูุงุฑ ุตู โ ุฌูุจ ููุงุฏู ูู API (fetchSubjectsByGrade)
   โ
4. ุนุฑุถ ูุงุฆูุฉ ุงูููุงุฏ ููุตู ุงููุฎุชุงุฑ
   โ
5. ุฅุฏุฎุงู ุงููููุฉ
   โ
6. ุฅุถุงูุฉ ุงููุชุงุจ ูุน ุญูุธ IDs (gradeId, subjectId)
```

### ๐ ุงูุจูุงูุงุช ุงููุฑุณูุฉ:
```json
{
  "school_id": 45,
  "items": [
    {
      "subject_id": 5,      // โ ID ุงููุงุฏุฉ ูู Backend
      "grade_id": 3,        // โ ID ุงูุตู ูู Backend
      "term_number": 1,     // ุงููุตู ุงูุฃูู
      "quantity": 50
    }
  ]
}
```

---

## ๐ 2. ูููุฐุฌ ุงูุจูุงูุงุช ุงููุญุฏุซ

### โ Book Model - ูุน IDs ุงููุนููุฉ
```dart
class Book {
  final String id;
  final String title;
  final String grade;
  final int quantity;
  final int? gradeId;        // โ ุฌุฏูุฏ
  final int? subjectId;      // โ ุฌุฏูุฏ
}
```

### โ SchoolRequestItem - ูุน IDs ุงููุนููุฉ
```dart
class SchoolRequestItem {
  final int? gradeId;        // โ ุฌุฏูุฏ
  final int? subjectId;      // โ ุฌุฏูุฏ
  final String? bookTitle;
  final int quantity;
  final String term;
}
```

---

## ๐ 3. ุนุฑุถ ุงูุดุญูุงุช

### โ SchoolDeliveryService - ุฌูุจ ุงูุดุญูุงุช ุงููุงุฑุฏุฉ
```dart
Future<void> fetchIncomingDeliveries()
  โ GET /api/warehouses/school/shipments/incoming/
  โ ููุตู ุจูู ุงููุงุฑุฏุฉ ูุงููุณุชููุฉ ุญุณุจ ุงูุญุงูุฉ
```

### โ SchoolDashboardNew - ุนุฑุถ ุงูุดุญูุงุช

**ุงูุชุจููุจุฉ ุงูุฃููู: ุงูุดุญูุงุช ุงููุงุฑุฏุฉ**
- ุนุฑุถ ุงูุดุญูุงุช ุงููุงุฏูุฉ ูู ุงููุญุงูุธุฉ
- ูุนูููุงุช: ููุ ุชุงุฑูุฎ ุงูุฅูุดุงุกุ ุนุฏุฏ ุงููุชุจุ ุงุณู ุงูููุฏูุจ
- ุนุฑุถ ูุงุฆูุฉ ุงููุชุจ ูู ุงูุดุญูุฉ
- ุนุฑุถ QR Code (ููููุฏูุจ ุนูุฏ ุงูุชุณููู)
- ุญุงูุฉ ุงูุดุญูุฉ ุจุงูููู:
  - ๐ ุจุฑุชูุงูู = ููุฏ ุงูุชูุตูู (assigned, in_transit)
  - ๐ข ุฃุฎุถุฑ = ุชู ุงูุชุณููู (delivered)

**ุงูุชุจููุจุฉ ุงูุซุงููุฉ: ุงูุดุญูุงุช ุงููุณุชููุฉ**
- ุนุฑุถ ุงูุดุญูุงุช ุงููุณุชููุฉ ุณุงุจูุงู
- ูุนูููุงุช ุงููุณุชูุจู ูุงูุชุงุฑูุฎ
- ุญุงูุฉ: ุชู ุงูุงุณุชูุงู ุจูุฌุงุญ

---

## ๐ 4. ุนูููุงุช ุงูููุฏูุจ (Driver Operations)

### โ ShipmentService - ุงูุนูููุงุช ุงููุชุงุญุฉ

#### 1. ุฌูุจ ุงูุดุญูุงุช ุงููุดุทุฉ
```dart
fetchActiveShipments()
  โ GET /api/warehouses/mobile/driver/shipments/active/
  โ ุดุญูุงุช ูุณูุฏุฉ ููููุฏูุจ ูุฌุงูุฒุฉ ููุชูุตูู
```

#### 2. ุฌูุจ ุณุฌู ุงูุดุญูุงุช
```dart
fetchShipmentHistory()
  โ GET /api/warehouses/mobile/driver/shipments/history/
  โ ุงูุดุญูุงุช ุงูููุชููุฉ ูุงูููุบุงุฉ ูุงููุฑููุถุฉ
```

#### 3. ุจุฏุก ุงูุชูุตูู
```dart
startDelivery(int shipmentId)
  โ POST /api/warehouses/mobile/driver/shipments/{id}/start_delivery/
  โ ุชุบููุฑ ุงูุญุงูุฉ ูู assigned ุฅูู in_transit
```

#### 4. ุชุญููู ุตูุฑุฉ ุงูุฅุซุจุงุช
```dart
uploadProofPhoto(int shipmentId, String photoBase64)
  โ POST /api/warehouses/mobile/driver/shipments/{id}/upload-photo/
  โ ุญูุธ ุตูุฑุฉ ุฅุซุจุงุช ุงูุชุณููู
```

#### 5. ุฅููุงู ุงูุชูุตูู
```dart
completeDelivery(int shipmentId, String? notes)
  โ POST /api/warehouses/mobile/driver/shipments/{id}/confirm_delivery/
  โ ุชุฃููุฏ ุงูุชุณููู ุงูููุงุฆู ูุชุบููุฑ ุงูุญุงูุฉ ุฅูู delivered
```

#### 6. ูุณุญ QR Code (ุงูููู!)
```dart
scanQrCodeUnified(String qrToken, ...)
  โ POST /api/warehouses/mobile/unified-scan/
  โ ุชุฃููุฏ ุงูุชุณููู ุนู ุทุฑูู ูุณุญ ุฑูุฒ QR
  โ ูุนุฏู ุญุงูุฉ ุงูุดุญูุฉ ุชููุงุฆูุงู ุฅูู delivered
```

#### 7. ุฌูุจ ุฅุญุตุงุฆูุงุช ุงูุฃุฏุงุก
```dart
fetchPerformance()
  โ GET /api/warehouses/mobile/driver/performance/
  โ ุฅุฌูุงูู ุงูุชูุตููุงุชุ ุงููููุ ุงูุดูุฑุ ูุนุฏู ุงููุฌุงุญ
```

---

## ๐ 5. ุงูุฅุญุตุงุฆูุงุช ูุงูุนุฑูุถ

### โ School Home Screen
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ุฅุญุตุงุฆูุงุช ุงููุฏุฑุณุฉ                โ
โ                                 โ
โ  โข ุดุญูุงุช ูุงุฏูุฉ: 5              โ
โ  โข ุดุญูุงุช ูุณุชููุฉ: 12            โ
โ  โข ุทูุจุงุช ููุฏ ุงููุฑุงุฌุนุฉ: 2       โ
โ  โข ุทูุจุงุช ูุนุชูุฏุฉ: 8             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### โ Driver Dashboard
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ููุญุฉ ุชุญูู ุงูููุฏูุจ              โ
โ                                 โ
โ  โข ูุดุทุฉ (5)   โข ุณุฌู (24)      โ
โ  โข ุงูุฃุฏุงุก (ุฅุญุตุงุฆูุงุช)           โ
โ                                 โ
โ  - ุฅุฌูุงูู: 127 ุชูุตููุฉ         โ
โ  - ุงูููู: 8 ุชูุตููุงุช            โ
โ  - ุงูุดูุฑ: 45 ุชูุตููุฉ            โ
โ  - ูุนุฏู ุงููุฌุงุญ: 96.5%          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ 6. ูุณุงุฑ ุงูุจูุงูุงุช ุงููุงูู

### ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  School Order Screen                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ 1. ุงุฎุชุฑ ูุตู ุฏุฑุงุณู               โ   โ
โ  โ    (ุงูุฃูู โ ุงูุซุงูู)             โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ 2. ุงุฎุชุฑ ุตู (ูู API)             โ   โ
โ  โ    GET /api/grades/             โ   โ
โ  โ    โ [ุงูุฃูู, ุงูุซุงูู, ...]      โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ 3. ุงุฎุชุฑ ูุงุฏุฉ ููุตู               โ   โ
โ  โ    GET /api/grades/{id}/subjectsโ   โ
โ  โ    โ [ุนุฑุจู, ุฑูุงุถูุงุช, ...]      โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ 4. ุฃุฏุฎู ุงููููุฉ                  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ 5. ุฃุถู ุงููุชุงุจ โ ุญูุธ gradeId ู   โ   โ
โ  โ                  subjectId       โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                โ                        โ
โ  Order Service                          โ
โ  createSchoolRequest()                  โ
โ                                         โ
โ  POST /api/school-requests/             โ
โ  create_from_flutter/                   โ
โ                โ                        โ
โ  Backend                                โ
โ  - ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช              โ
โ  - ุฑุจุท ุงูููุงุฏ ุจุงูุตููู                  โ
โ  - ุชุนููู ุงูุญุงูุฉ: submitted             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุนุฑุถ ุงูุดุญูุงุช:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ School Home Screen             โ
โ โ                              โ
โ SchoolDeliveryService          โ
โ fetchIncomingDeliveries()      โ
โ โ                              โ
โ GET /api/warehouses/school/    โ
โ     shipments/incoming/        โ
โ โ                              โ
โ ShipmentListResponse {         โ
โ   count, next, previous,       โ
โ   results: [ApiShipment, ...]  โ
โ }                              โ
โ โ                              โ
โ School Dashboard               โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ Incoming Tab:              โ โ
โ โ - ุดุญูุงุช ูุงุฏูุฉ              โ โ
โ โ - ูู ุดุญูุฉ ุชุนุฑุถ:           โ โ
โ โ   โข ุฑูู ุงูุชุชุจุน             โ โ
โ โ   โข ูู (ูุฒุงุฑุฉ)            โ โ
โ โ   โข ุงููุชุจ (ูุงุฆูุฉ)          โ โ
โ โ   โข ุงูุญุงูุฉ                 โ โ
โ โ   โข ุงุณู ุงูููุฏูุจ            โ โ
โ โ   โข QR Code               โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค โ
โ โ Received Tab:              โ โ
โ โ - ุดุญูุงุช ูุณุชููุฉ             โ โ
โ โ - ุชูุงุตูู ุงูุงุณุชูุงู          โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุนูููุงุช ุงูููุฏูุจ:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Driver Dashboard               โ
โ โ                              โ
โ ShipmentService                โ
โ                                โ
โ Active Tab:                    โ
โ โโ fetchActiveShipments()      โ
โ โ  โ GET /api/.../active/      โ
โ โ  โ ูุงุฆูุฉ ุงูุดุญูุงุช ุงูููููุฉ     โ
โ โ                              โ
โ โโ Click Shipment โ Details   โ
โ โ  โ ShipmentDetailScreen      โ
โ โ  โ ุนุฑุถ ุงูุชูุงุตูู             โ
โ โ                              โ
โ โโ Start Delivery             โ
โ โ  โ POST .../start_delivery/  โ
โ โ  โ ูุบูุฑ ุงูุญุงูุฉ ูู in_transit  โ
โ โ                              โ
โ โโ Upload Photo               โ
โ โ  โ POST .../upload-photo/    โ
โ โ  โ ูุญูุธ ุตูุฑุฉ ุงูุฅุซุจุงุช        โ
โ โ                              โ
โ โโ Complete Delivery          โ
โ โ  โ POST .../confirm_delivery/โ
โ โ  โ ูุบูุฑ ุงูุญุงูุฉ ูู delivered  โ
โ โ                              โ
โ โโ Scan QR Code              โ
โ    โ POST .../unified-scan/    โ
โ    โ ุชุณููู ููุงุฆู ุจู QR       โ
โ                                โ
โ History Tab:                   โ
โ โโ fetchShipmentHistory()      โ
โ โ  โ GET /api/.../history/     โ
โ โ  โ ุณุฌู ุงูุชูุตููุงุช             โ
โ                                โ
โ Performance Tab:               โ
โ โโ fetchPerformance()          โ
โ    โ GET /api/.../performance/ โ
โ    โ ุงูุฅุญุตุงุฆูุงุช               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ 7. Endpoints ุงููุณุชุฎุฏูุฉ

### **ุงููุฏุงุฑุณ**

| ุงููุนูููุฉ | Endpoint | ุงูุทูุจ | ุงูุงุณุชุฎุฏุงู |
|---------|----------|------|----------|
| ุฌูุจ ุงูุตููู | `/api/grades/` | GET | ุงุฎุชูุงุฑ ุงูุตู ูู ุงูุทูุจ |
| ุฌูุจ ุงูููุงุฏ | `/api/subjects/` | GET | - |
| ุฌูุจ ููุงุฏ ุตู | `/api/grades/{id}/subjects/` | GET | ุงุฎุชูุงุฑ ุงููุงุฏุฉ ูู ุงูุทูุจ |
| ุฅูุดุงุก ุทูุจ | `/api/school-requests/create_from_flutter/` | POST | ุฅุฑุณุงู ุทูุจ ุฌุฏูุฏ |
| ุฌูุจ ุงูุทูุจุงุช | `/api/school-requests/?school_id={id}` | GET | ุนุฑุถ ุทูุจุงุช ุงููุฏุฑุณุฉ |
| ุฌูุจ ุงูุดุญูุงุช | `/api/warehouses/school/shipments/incoming/` | GET | ุนุฑุถ ุงูุดุญูุงุช ุงููุงุฑุฏุฉ |
| ุงุณุชูุจุงู ุดุญูุฉ | `/api/warehouses/school/deliveries/{id}/receive/` | POST | ุชุฃููุฏ ุงุณุชูุจุงู ูุฏูู |

### **ุงูููุงุฏูุจ (ุงูุณุงุฆููู)**

| ุงููุนูููุฉ | Endpoint | ุงูุทูุจ | ุงูุงุณุชุฎุฏุงู |
|---------|----------|------|----------|
| ุงูุดุญูุงุช ุงููุดุทุฉ | `/api/warehouses/mobile/driver/shipments/active/` | GET | ุนุฑุถ ุงูุดุญูุงุช ุงูููููุฉ |
| ุณุฌู ุงูุดุญูุงุช | `/api/warehouses/mobile/driver/shipments/history/` | GET | ุนุฑุถ ุงูุณุฌู |
| ุจุฏุก ุงูุชูุตูู | `/api/warehouses/mobile/driver/shipments/{id}/start_delivery/` | POST | ุชุบููุฑ ุงูุญุงูุฉ |
| ุชุญููู ุตูุฑุฉ | `/api/warehouses/mobile/driver/shipments/{id}/upload-photo/` | POST | ุญูุธ ุฅุซุจุงุช |
| ุฅููุงู ุงูุชูุตูู | `/api/warehouses/mobile/driver/shipments/{id}/confirm_delivery/` | POST | ุชุฃููุฏ ุงูุชุณููู |
| ูุณุญ QR | `/api/warehouses/mobile/unified-scan/` | POST | **ุชุณููู ุจู QR** |
| ุงูุฃุฏุงุก | `/api/warehouses/mobile/driver/performance/` | GET | ุฅุญุตุงุฆูุงุช ุงูุฃุฏุงุก |

---

## โ 8. ูุงุฆูุฉ ุงูุชุญูู

- โ ุฌูุจ ุงูุตููู ูุงูููุงุฏ ูู Backend
- โ ุนุฑุถ ูุงุฆูุฉ ุงูุตููู ูู ุงูุดุงุดุฉ
- โ ุฌูุจ ุงูููุงุฏ ุนูุฏ ุงุฎุชูุงุฑ ุตู
- โ ุนุฑุถ ูุงุฆูุฉ ุงูููุงุฏ ูู ุงูุดุงุดุฉ
- โ ุญูุธ IDs (gradeId, subjectId) ุนูุฏ ุฅุถุงูุฉ ูุชุงุจ
- โ ุฅุฑุณุงู IDs ุฅูู Backend ุนูุฏ ุฅูุดุงุก ุทูุจ
- โ ุนุฑุถ ุงูุดุญูุงุช ุงููุงุฑุฏุฉ ูุน ุงูุชูุงุตูู
- โ ุนุฑุถ ุงูุดุญูุงุช ุงููุณุชููุฉ ุจุดูู ูููุตู
- โ ุนุฑุถ ููุงุฆู ุงููุชุจ ูู ุงูุดุญูุงุช
- โ ุนุฑุถ QR Code (ููููุฏูุจ)
- โ ุฌูุจ ุงูุดุญูุงุช ุงููุดุทุฉ ููููุฏูุจ
- โ ุจุฏุก ุงูุชูุตูู
- โ ุชุญููู ุตูุฑ ุงูุฅุซุจุงุช
- โ ุฅููุงู ุงูุชูุตูู
- โ ูุณุญ QR Code
- โ ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช

---

## ๐ 9. ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงูููุชุฑุญุฉ)

1. **ููุงุณ ุงูุฃุฏุงุก**: ุชุญุณูู ุงุณุชุฌุงุจุฉ API
2. **ุงูุชูุจููุงุช**: ุฅุถุงูุฉ Push Notifications
3. **Offline Mode**: ุญูุธ ุงูุจูุงูุงุช ูุญููุงู
4. **ุงูุชูุงุฑูุฑ**: ุชุตุฏูุฑ ุชูุงุฑูุฑ PDF
5. **ุงูุฎุฑุงุฆุท**: ุนุฑุถ ุงูุดุญูุงุช ุนูู ุงูุฎุฑูุทุฉ

---

## ๐ ููุงุญุธุงุช

- ุฌููุน ุงูู Endpoints ูุชุทุงุจูุฉ ูุน Backend ุงูุญุงูู
- ุฌููุน ุงูู IDs ูู Backend (gradeId, subjectId)
- ุงูุจูุงูุงุช ูุญุฏุซุฉ ุชููุงุฆูุงู ุนูุฏ Refresh
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุดุงููุฉ ูุน ุฑุณุงุฆู ูุงุถุญุฉ

---

**ุชู ุงูุฅูุฌุงุฒ:** โ  
**ุงูุญุงูุฉ:** ุฌุงูุฒ ููุงุฎุชุจุงุฑ ูุงููุดุฑ
